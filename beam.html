<!-- Can Update with the equations as used in Acceleration Analysis File -->

<!DOCTYPE html>
<html lang="en-US">

<head>
<meta charset="UTF-8">

<title>SOLVE - Beam Questions</title>

<!-- DND-Required css and js files -->
<link rel="stylesheet" href="sins/MOMstyle.css" />

<script src='http://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js'></script>
<script src='http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.0/jquery-ui.min.js'></script>


<script type="text/javascript" src= "sins/MOMscript.js"></script>

<script type="text/javascript" >
//Script specific to simulation


//comments section
var commenttext="Some Text";
var commentloc=0;


//simulation constants
var x_offset = 100; //local origin - x
var y_offset = 250; //local origin - y
var trans= new point(x_offset,y_offset);
var beamLength = 400;
var beamWidth = 10;
var support_length = 50;
var support_width = 20;
var deflection_value = 100;
var number_of_lines = 100;
var e = 25; //e in the formula
var i = 25; //i in the formula


var o= new point(0,0,"");

//graphics section
var canvas;
var ctx;
//timing section
var simTimeId = setInterval("",'1000');
var pauseTime = setInterval("",'1000');
var time=0;
//point tracing section
var ptx = [];
var pty = [];


const FIXED_BEAM = 0;
const CANTILEVER_BEAM = 1;
const THIRD_ONE = 2;

var scene = FIXED_BEAM;
/*
// for trials during development
function trythis()
{     alert();}
*/

//change simulation specific css content. e.g. padding on top of variable to adjust appearance in variables window
function editcss()
{
$('.variable').css('padding-top','40px');

}

//start of simulation here; starts the timer with increments of 0.1 seconds
function startsim()
{
simTimeId=setInterval("time=time+0.1; varupdate(); ",'100');
}

//Initialise system parameters here
function varinit()
{
  varchange();
  var init_a = x_offset + beamLength / 2; 
  var init_force = 0;

  $('#aslider').slider("value", init_a);  
  $('#aspinner').spinner("value", init_a);



  $('#forceslider').slider("value", init_force);  
  $('#forcespinner').spinner("value", init_force);

}

// Initialise and Monitor variable containing user inputs of system parameters.
//change #id and repeat block for new variable. Make sure new <div> with appropriate #id is included in the markup
function varchange()
{
  //Variable a postion slider and number input types
  $('#aslider').slider({ max : beamLength, min : 0, step : 5 });    // slider initialisation : jQuery widget
  $('#aspinner').spinner({ max : beamLength, min : 0, step : 5 });    // number initialisation : jQuery widget  

  // monitoring change in value and connecting slider and number
  // setting trace point coordinate arrays to empty on change of link length
  $( "#aslider" ).on( "slide", function( e, ui ) { $('#aspinner').spinner("value",ui.value); ptx=[]; pty=[]; } );
  $( "#aspinner" ).on( "spin", function( e, ui ) { $('#aslider').slider("value",ui.value); ptx=[]; pty=[]; } );
  $( "#aspinner" ).on( "change", function() {  varchange() } );


  //Variable force slider and number input types
  $('#forceslider').slider({ max : 360, min : 0, step : 2 });   // slider initialisation : jQuery widget
  $('#forcespinner').spinner({ max : 360, min : 0, step : 2 });   // number initialisation : jQuery widget      
  // monitoring change in value and connecting slider and number
  // setting trace point coordinate arrays to empty on change of link length
  $( "#forceslider" ).on( "slide", function( e, ui ) { $('#forcespinner').spinner("value",ui.value); ptx=[]; pty=[]; } );
  $( "#forcespinner" ).on( "spin", function( e, ui ) { $('#forceslider').slider("value",ui.value); ptx=[]; pty=[]; } );
  $( "#forcespinner" ).on( "change", function() {  varchange() } );


  varupdate();

}

//Computing of various system parameters
function varupdate()
{

  $('#aslider').slider("value", $('#aspinner').spinner('value'))
  $('#forceslider').slider("value", $('#forcespinner').spinner('value')); 
  load_point = $('#aspinner').spinner("value");
  load = $('#forcespinner').spinner("value");
  o.xcoord=0;
  o.ycoord=0;

  if(scene == FIXED_BEAM)
    drawForFixed();
  else if(scene == CANTILEVER_BEAM)
    drawForCantilever();
  else
    drawForThirdOne();

}


/*
-------FOR   FIXED   BEAM------------------------------------------------------- 
*/

//Simulation graphics
function drawForFixed()
{
  canvas = document.getElementById("simscreen");
  ctx = canvas.getContext("2d");
  ctx.clearRect(0,0,550,400);  //clears the complete canvas#simscreen everytime


  pointtrans(o,trans);

  //left support
  ctx.beginPath();  
  ctx.strokeStyle="#825723";
  ctx.lineWidth=support_width;
  ctx.moveTo(o.xcoord,o.ycoord-(support_length/2));
  ctx.lineTo(o.xcoord,o.ycoord+(support_length/2));
  ctx.stroke();  
  ctx.closePath();

  //right support
  ctx.beginPath();
  ctx.strokeStyle= "#825723";
  ctx.lineWidth=support_width;
  ctx.moveTo(beamLength+x_offset + support_width,o.ycoord - (support_length/2));
  ctx.lineTo(beamLength + x_offset + support_width, o.ycoord + (support_length/2));
  ctx.stroke();
  ctx.closePath();


  ctx.beginPath();
  ctx.lineWidth=beamWidth;
  ctx.strokeStyle= "#000";

  printcomment("deflection: " + calculatDeflectionForCantilever(load_point, load, load_point), 0);


  var start = new point(x_offset+support_width/2, o.ycoord);
  for(var x = 0; x < number_of_lines; x++){
    ctx.moveTo(x_offset+support_width/2 + x*(beamLength/number_of_lines)
    ,calculatDeflectionForFixed(load_point, load, x*(beamLength/number_of_lines) )+ y_offset);

    ctx.lineTo(x_offset+support_width/2 + (x+1)*(beamLength/number_of_lines)
    ,calculatDeflectionForFixed(load_point, load, (x+1)*(beamLength/number_of_lines)) + y_offset);

    ctx.stroke();

  }
  ctx.closePath();  


  ctx.beginPath();
  ctx.globalAlpha=0.1;
  ctx.lineWidth=beamWidth;
  ctx.strokeStyle= "#000";
  ctx.moveTo(x_offset+support_width/2 ,o.ycoord);
  ctx.lineTo(beamLength+x_offset + support_width/2 ,o.ycoord);
  ctx.stroke();
  ctx.globalAlpha=1; 
  ctx.closePath();  

  //draw force arrow
  drawForceArrow(ctx);


}
function calculatDeflectionForFixed(load_point, load, x){
  
  if( x <= load_point ){
    return deflectionEquationForFixed(load/10000, load_point, x, e, i, beamLength);
  }
  else{
    return deflectionEquationForFixed(load/10000, beamLength- load_point, beamLength-x, e, i, beamLength);
  }

    
}

function deflectionEquationForFixed(p, a, x, e, i, l){
  var b = l -a;
  return (p*b*b*x*x)*(3*a*l - 3*a*x - b*x) / (6*e*i*l*l*l);
}


/*
-------FOR   CANTILEVER   BEAM------------------------------------------------------- 
*/

function drawForCantilever()
{
  canvas = document.getElementById("simscreen");
  ctx = canvas.getContext("2d");
  ctx.clearRect(0,0,550,400);  //clears the complete canvas#simscreen everytime


  pointtrans(o,trans);

  //left support
  ctx.beginPath();  
  ctx.strokeStyle="#825723";
  ctx.lineWidth=support_width;
  ctx.moveTo(o.xcoord,o.ycoord-(support_length/2));
  ctx.lineTo(o.xcoord,o.ycoord+(support_length/2));
  ctx.stroke();  
  ctx.closePath();


  ctx.beginPath();
  ctx.lineWidth=beamWidth;
  ctx.strokeStyle= "#000";

  printcomment("deflection: " + calculatDeflectionForCantilever(load_point, load, load_point), 0);


  var start = new point(x_offset+support_width/2, o.ycoord);
  for(var x = 0; x < number_of_lines; x++){
    ctx.moveTo(x_offset+support_width/2 + x*(beamLength/number_of_lines)
    ,calculatDeflectionForCantilever(load_point, load, x*(beamLength/number_of_lines) )+ y_offset
    );

    ctx.lineTo(x_offset+support_width/2 + (x+1)*(beamLength/number_of_lines)
    ,calculatDeflectionForCantilever(load_point, load, (x+1)*(beamLength/number_of_lines) )+ y_offset);

    ctx.stroke();

  }
  ctx.closePath();  


  ctx.beginPath();
  ctx.globalAlpha=0.1;
  ctx.lineWidth=beamWidth;
  ctx.strokeStyle= "#000";
  ctx.moveTo(x_offset+support_width/2 ,o.ycoord);
  ctx.lineTo(beamLength+x_offset + support_width/2 ,o.ycoord);
  ctx.stroke();
  ctx.globalAlpha=1; 
  ctx.closePath();  

  //draw force arrow
  drawForceArrow(ctx);


}


function calculatDeflectionForCantilever(load_point, load, x){
  p = load / 100000;
  if( x <= load_point ){
    return (p*x*x)*(3*load_point-x) / (6 * e * i); 
  }
  else{
    return (p*load_point*load_point)*(3*x- load_point ) / (6 * e * i); 
  }
    
}


function deflectionEquationForCantilever(p, a, x, e, i){
  return (p*b*b*x*x)*(3*a*l - 3*a*x - b*x) / (6*e*i*l*l*l);
}


/*
-------FOR   THIRD   BEAM------------------------------------------------------- 
*/
 
function drawForThirdOne(){}


/*
-------  GENERAL  ------------------------------------------------------- 
*/


function drawForceArrow(context){
  //context.save();
  force_pos_x = $('#aspinner').spinner("value") + x_offset + support_width/2;
  
  var deflection;
  if(scene == FIXED_BEAM)
     deflection = calculatDeflectionForFixed(load_point, load, load_point);
  else if(scene == CANTILEVER_BEAM)
    deflection = calculatDeflectionForCantilever(load_point, load, load_point);

  var arrow_bottom_tip_y = y_offset + deflection - beamWidth/2;
  var arrow_head_length = 30;
  var arrow_line_length = 50;
  var arrow_line_width = 5;

  context.beginPath();
  context.lineWidth=arrow_line_width;
  context.strokeStyle="#211b13";
  context.moveTo(force_pos_x,arrow_bottom_tip_y - arrow_head_length);
  context.lineTo(force_pos_x,arrow_bottom_tip_y - arrow_head_length-arrow_line_length);
  context.stroke();
  context.closePath();
  
  drawArrow(force_pos_x,arrow_bottom_tip_y,ctx,270,arrow_head_length,30,'#211b13','',"#211b13");
}

function changeScene(value){
  scene = value;
  if(value == FIXED_BEAM)
    document.getElementById('simtitle').innerHTML = "Fixed Beam";
  else if(value == CANTILEVER_BEAM)
    document.getElementById('simtitle').innerHTML = 'Cantilever Beam';
  else
    document.getElementById('simtitle').innerHTML = 'THIRD BEAM';
}

function drawrem(context)
{ 

// positioning dimension display  
   if(theta2%360<=180)
    offset=-45;
  else
    offset=20;

// dimension line      
  context.save();
  context.moveTo(o.xcoord,o.ycoord-offset);
  context.lineWidth=3;
  context.strokeStyle="#000000";
  context.lineTo(b.xcoord,o.ycoord-offset);
  context.moveTo(o.xcoord,o.ycoord-offset+5);
  context.lineTo(o.xcoord,o.ycoord-offset-5);
  context.moveTo(b.xcoord,o.ycoord-offset+5);
  context.lineTo(b.xcoord,o.ycoord-offset-5);
  context.stroke();
  
// arrows at dimension
  drawArrow(b.xcoord,b.ycoord-offset,context,180,15,30,'#000','',"#000");
  drawArrow(o.xcoord,o.ycoord-offset,context,0,15,30,'#000','',"#000");
  

// Position Analysis Title  
  context.save();
   context.lineWidth=1;
   context.font="12px 'Comic Sans MS'";
   context.fillStyle="#000000";
   context.fillText("Position Analysis", 15,15);
   context.restore();

// r, l, d display
  context.save();
  context.lineWidth=1;
  context.strokeStyle="#000000";
  context.font = "10px Arial";
  context.strokeText('d', (o.xcoord+b.xcoord)/2,o.ycoord-offset-10);  
  context.strokeText('r',(o.xcoord+a.xcoord)/2-1,(o.ycoord+a.ycoord)/2+1);
  context.strokeText('l',(a.xcoord+b.xcoord)/2-1,(a.ycoord+b.ycoord)/2+3);
  context.restore();
}

// prints comments passed as 'commenttext' in location specified by 'commentloc' in the comments box;
// 0 : Single comment box, 1 : Left comment box, 2 : Right comment box
function printcomment(commenttext,commentloc)
{
  if(commentloc==0)
  {
  document.getElementById('commentboxright').style.visibility='hidden';
  document.getElementById('commentboxleft').style.width='570px';
  document.getElementById('commentboxleft').innerHTML = commenttext;
  }
  else if(commentloc==1)
  {
  document.getElementById('commentboxright').style.visibility='visible';
  document.getElementById('commentboxleft').style.width='285px';
  document.getElementById('commentboxleft').innerHTML = commenttext;
  }
  else if(commentloc==2)
  {
  document.getElementById('commentboxright').style.visibility='visible';
  document.getElementById('commentboxleft').style.width='285px';
  document.getElementById('commentboxright').innerHTML = commenttext;
  }
  else
  {
  document.getElementById('commentboxright').style.visibility='hidden';
  document.getElementById('commentboxleft').style.width='570px';
  document.getElementById('commentboxleft').innerHTML = "<center>please report this issue to adityaraman@gmail.com</center>"; 
  // ignore use of deprecated tag <center> . Code is executed only if printcomment function receives inappropriate commentloc value
  }
}

</script>

</head>

<body onload="editcss(); startsim(); varinit();">

<!-- DND-Verifying JavaScript is enabled in browser -->
<noscript>
The simulation requires JavaScript to be enabled.
</noscript>



<!-- Defining Container for Simulation -->
<div id="container">

<!-- Replace TITLE with simulation title to be displayed next to logo-->
<div id="simtitle">Fixed Beam</div>

<!-- Region for simulation display -->
<canvas id="simscreen" height="400px" width="550px"></canvas>

<div id="titleincanvas"></div>
<div id="datatable1" class="datatable"></div>
<div id="datatable2" class="datatable"></div>

<!-- Equation Reference and Legend for Graphs etc 
<div id="quickreficon" title="Equations" onclick="showEquations();"></div>
<div id="quickref"><img id="quickrefimg" src="sins/tick.png"></img></div>
<div id="legendicon" title="Legend" onclick="showLegend();"></div>
<div id="legend"><img id="legendimg" src="sins/tick.png"></img></div>
-->
<!-- Region for comment / question prompts -->
<div id="commentboxleft"></div>
<div id="commentboxright"></div>

<!-- DND-Title of region for variables display --> 
<div id="vartitle">VARIABLES</div>

<!-- Region for Input parameters of simulation -->
<div id="variables">

<!-- System variable input from user through slider and spinner jQuery widgets 
repeat block with new variable name and new id for widgets-->

<div class="variable">
<div class="varname"><p title="Link Length">a (cm)</p>
<input id="aspinner"></input></div>
<div id="aslider"></div>
</div>

<!-- <div class="variable">
<div class="varname"><p title="Link Length">b (cm)</p>
<input id="r3spinner"></input></div>
<div id="r3slider"></div>
</div>
 -->
<div id = "theta2set" class="variable">
<div class="varname"><p title='Input Angle'>force (N) </p>
<input id="forcespinner"></input></div>
<div id="forceslider"></div>
</div>

<!-- <div id = "omega2set" class="variable">
<div class="varname"><p title='Input Angular Velocity'>&omega; (rad/s) </p>
<input id="omega2spinner"></input></div>
<div id="omega2slider"></div>
</div> -->
</div>

<!-- DND-Title of region for controls display -->
<div id="ctrltitle">CONTROLS</div>

<!-- Region for User controls of simulation -->
<div id="controls">
<button id = "fixedbeam" onClick="changeScene(FIXED_BEAM)">Fixed Beam</button> 
<button id = "cantileverbeam" onClick="changeScene(CANTILEVER_BEAM)">Cantilever Beam</button> 
<button id = "thirdone" onClick="drawForThirdOne()">Third Beam</button> 

<!-- <img id="playpausebutton" onclick="simstate()" src="sins/bluepausedull.png" />
<img id="rotationbutton" onclick="rotstate()" src="sins/bluecwdull.png" /> -->

</div>

<!-- DND-Copyright display-->
<div id="copyright" title="Developer : Chandan Naik and Sumanta Dewri Prasad"> Copyright &copy; SOLVE The Virtual Lab @ NITK Surathkal </div>

</div><!-- Container div close -->

<!-- For trials during development
write in trythis() function the outputs that you want to check.
<input type='button' onclick='trythis()' value="try me"></input> 
-->
</body>
</html>
